<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ƒ∞MAR DURUMU</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f7f9; }
  .container { max-width: 700px; margin: 20px auto; background: #fff; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,.1); }
  header { display:flex; justify-content:space-between; align-items:center; padding-bottom:10px; border-bottom:2px solid #3498db; margin-bottom:20px; position:relative; gap:10px; }
  header h1 { color:#3498db; margin:0; font-size:1.5em; }
  .header-info { font-size:.9em; color:#555; text-align:right; }
  .back-btn { position:absolute; left:0; top:0; background:#d32f2f; color:#fff; padding:10px 15px; border-radius:8px; font-weight:bold; cursor:pointer; border:none; }
  .form-section { margin-bottom:20px; padding:10px; border:1px solid #ddd; border-radius:5px; }
  .form-section label { display:block; font-weight:bold; margin-top:10px; margin-bottom:5px; }
  .radio-group { display:flex; flex-wrap:wrap; gap:15px; }
  .radio-group div { display:flex; align-items:center; gap:6px; }
  input[type="text"], input[type="number"] { padding:8px; border:1px solid #ccc; border-radius:4px; width:100%; box-sizing:border-box; }
  #diƒüer-nizam-kutusu, #yola-tecav√ºz-alan-kutusu { margin-left:10px; display:none; }
  .hmax-bilgi { margin-left:20px; font-size:.9em; color:#e74c3c; font-weight:bold; }
  #otomatik-metin-alani { margin-top:30px; padding-top:20px; border-top:1px solid #ccc; }
  .mavi-kutu { background:#eaf6ff; border:1px solid #3498db; padding:15px; margin-bottom:15px; border-radius:5px; }
  .yesil-kutu { background:#ebf5eb; border:1px solid #2ecc71; padding:15px; border-radius:5px; }
  table { width:100%; border-collapse:collapse; margin-bottom:10px; font-size:.9em; }
  table, th, td { border:1px solid #3498db; }
  th, td { padding:8px; text-align:left; }
  .action-button { padding:15px 20px; font-size:1.1em; border:none; border-radius:5px; cursor:pointer; margin-top:15px; display:block; width:100%; transition:.3s; font-weight:bold; }
  #kaydet-button { background:#2ecc71; color:#fff; }
  .btn-menu { background:#9c27b0; color:#fff; }
  .status-msg { display:none; text-align:center; font-weight:bold; margin-top:10px; padding:10px; border-radius:8px; }

  .module-badge { display:inline-flex; align-items:center; border:1px solid #ddd; border-radius:999px; padding:6px 10px; font-weight:800; font-size:12px; background:#fff; }
  .badge-empty { color:#6c757d; }
  .badge-draft { color:#856404; background:#fff3cd; border-color:#ffeeba; }
  .badge-done { color:#0f5132; background:#d1e7dd; border-color:#badbcc; }

  .suggest-wrap { position:relative; }
  .suggest-box { position:absolute; left:0; right:0; top:calc(100% + 6px); background:#fff; border:1px solid #ddd; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,.12); overflow:hidden; z-index:9999; display:none; }
  .suggest-item { padding:10px 12px; cursor:pointer; border-bottom:1px solid #f1f1f1; font-weight:700; font-size:13px; }
  .suggest-item:last-child { border-bottom:none; }
  .suggest-item:hover { background:#f5f7fa; }
  .suggest-foot { padding:8px 12px; font-size:12px; color:#6c757d; background:#fafafa; border-top:1px solid #f1f1f1; }

  @media (max-width:768px){ .container{margin:10px;padding:14px;} header{padding-top:46px;} .back-btn{top:10px;left:10px;} }
</style>
</head>

<body oncontextmenu="return false;">
<div class="container">
  <header>
    <button onclick="anaMenuyeDon()" class="back-btn">‚Üê ANA MEN√ú</button>
    <h1>ƒ∞MAR DURUMU</h1>
    <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
      <div id="raporBilgi" class="header-info">Y√ºkleniyor...</div>
      <div class="module-badge"><span id="moduleBadgeText" class="badge-empty">‚¨ú Bo≈ü</span></div>
    </div>
  </header>

  <form id="imar-form" autocomplete="off">
    <div class="form-section">
      <label>ƒ∞mar Planƒ± ƒ∞smi</label>
      <input type="text" id="imar-plani-ismi" placeholder="√ñrn: 1/1000 √ñl√ßekli Uygulama ƒ∞mar Planƒ±">
    </div>

    <div class="form-section">
      <label>1. Yapƒ± Nizamƒ±:</label>
      <div class="radio-group" id="yapi-nizam-group">
        <div><input type="radio" name="nizam" value="Ayrƒ±k" id="nizam-ayrik"><label for="nizam-ayrik">Ayrƒ±k</label></div>
        <div><input type="radio" name="nizam" value="Biti≈üik" id="nizam-bitisik"><label for="nizam-bitisik">Biti≈üik</label></div>
        <div><input type="radio" name="nizam" value="Blok" id="nizam-blok"><label for="nizam-blok">Blok</label></div>
        <div><input type="radio" name="nizam" value="Serbest" id="nizam-serbest"><label for="nizam-serbest">Serbest</label></div>
        <div><input type="radio" name="nizam" value="Diƒüer" id="nizam-diger"><label for="nizam-diger">Diƒüer</label></div>
        <input type="text" id="diƒüer-nizam-kutusu" placeholder="Belirtiniz">
      </div>
    </div>

    <div class="form-section">
      <label for="kat-sayisi">2. Kat Sayƒ±sƒ±:</label>
      <input type="number" id="kat-sayisi" min="1">
      <span id="hmax-output" class="hmax-bilgi"></span>
    </div>

    <div class="form-section">
      <label for="taks">4. TAKS / 5. KAKS:</label>
      <div style="display:flex; gap:10px;">
        <input type="text" id="taks" placeholder="TAKS (√ñrn: 0.40)">
        <input type="text" id="kaks" placeholder="KAKS (√ñrn: 1.60)">
      </div>
    </div>

    <div class="form-section">
      <label for="yola-terk">6. Yola Terk (m¬≤):</label>
      <input type="number" id="yola-terk" min="0" value="0">
      <div id="tecavuz-sorusu" style="display:none; margin-top:10px;">
        <label>Yola tecav√ºz var mƒ±?</label>
        <div class="radio-group">
          <div><input type="radio" name="tecavuz" value="Hayƒ±r" id="tecavuz-hayir" checked><label for="tecavuz-hayir">Hayƒ±r</label></div>
          <div><input type="radio" name="tecavuz" value="Evet" id="tecavuz-evet"><label for="tecavuz-evet">Evet</label></div>
          <input type="number" id="yola-tecav√ºz-alan-kutusu" placeholder="m¬≤">
        </div>
      </div>
    </div>

    <div class="form-section">
      <label>7. Kentsel D√∂n√º≈ü√ºm Alanƒ± mƒ±?</label>
      <div class="radio-group">
        <div><input type="radio" name="kentsel" value="Evet" id="kentsel-evet"><label for="kentsel-evet">Evet</label></div>
        <div><input type="radio" name="kentsel" value="Hayƒ±r" id="kentsel-hayir" checked><label for="kentsel-hayir">Hayƒ±r</label></div>
      </div>
    </div>

    <div class="form-section">
      <label>8. Riskli Yapƒ± ƒ∞lanƒ± Var mƒ±?</label>
      <div class="radio-group">
        <div><input type="radio" name="riskli" value="Evet" id="riskli-evet"><label for="riskli-evet">Evet</label></div>
        <div><input type="radio" name="riskli" value="Hayƒ±r" id="riskli-hayir" checked><label for="riskli-hayir">Hayƒ±r</label></div>
      </div>
    </div>

    <button type="button" id="kaydet-button" class="action-button" onclick="kaydet(false)">VERƒ∞LERƒ∞ KAYDET VE HAFIZAYA AL</button>
    <div id="statusBox" class="status-msg"></div>
    <button type="button" class="action-button btn-menu" onclick="anaMenuyeDon()">ANA MEN√úYE D√ñN</button>
  </form>

  <div id="otomatik-metin-alani">
    <div class="mavi-kutu">
      <h4>√ñzet Tablo (Banka ƒ∞√ßin)</h4>
      <table id="banka-tablo-output"></table>
    </div>
    <div class="yesil-kutu">
      <h4>Tam Rapor Metni</h4>
      <p id="rapor-metni-output"></p>
    </div>
  </div>
</div>

<!-- ‚úÖ TEK STORAGE KATMANI -->
<script src="storage.js"></script>

<script>
const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');
if(!id){ alert("Bu sayfa ?id=... olmadan a√ßƒ±lmƒ±≈ü."); }

const MODULE_KEY = 'imar';
const LS_SUGG_GLOBAL = 'gayrimenkul_suggestions_v1';

let report = RaporStorage.get(id) || { imar:{}, modules:{} };
report.modules = report.modules || {};
RaporStorage.set(id, report);

function ensureModuleState(){
  report.modules[MODULE_KEY] = report.modules[MODULE_KEY] || {};
  return report.modules[MODULE_KEY];
}

function computeStatus(mod){
  const started=!!mod.started;
  const savedAt=mod.savedAt || null;
  const complete=!!mod.complete;
  if(!started) return 'empty';
  if(savedAt && complete) return 'done';
  return 'draft';
}

function setBadge(status){
  const el=document.getElementById('moduleBadgeText');
  el.className='';
  if(status==='empty'){ el.textContent='‚¨ú Bo≈ü'; el.classList.add('badge-empty'); return; }
  if(status==='draft'){ el.textContent='üü® Taslak'; el.classList.add('badge-draft'); return; }
  el.textContent='‚úÖ Tamam'; el.classList.add('badge-done');
}

function persist(){
  RaporStorage.set(id, report);
  setBadge(computeStatus(ensureModuleState()));
}

function onUserRealInput(){
  const mod=ensureModuleState();
  if(!mod.started){
    mod.started=true;
    mod.startedAt=mod.startedAt || Date.now();
    persist();
  }
}

/* --- 5 √∂neri (basit) --- */
let suggestionStore = (function(){
  try { return JSON.parse(localStorage.getItem(LS_SUGG_GLOBAL)) || {fields:{}}; }
  catch { return {fields:{}}; }
})();
function saveSuggestionStore(){ localStorage.setItem(LS_SUGG_GLOBAL, JSON.stringify(suggestionStore)); }
function norm(v){ return String(v||'').trim().replace(/\s+/g,' '); }
function addSuggestion(fieldKey,value){
  const v=norm(value);
  if(!v || v.length<2) return;
  suggestionStore.fields[fieldKey]=suggestionStore.fields[fieldKey]||[];
  suggestionStore.fields[fieldKey]=suggestionStore.fields[fieldKey].filter(x=>norm(x).toLowerCase()!==v.toLowerCase());
  suggestionStore.fields[fieldKey].unshift(v);
  suggestionStore.fields[fieldKey]=suggestionStore.fields[fieldKey].slice(0,50);
  saveSuggestionStore();
}
function top5(fieldKey){ return (suggestionStore.fields[fieldKey]||[]).slice(0,5); }
function escapeHtml(str){
  return String(str||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;");
}
function attachSuggest(inputEl, fieldKey){
  if(!inputEl.closest('.suggest-wrap')){
    const wrap=document.createElement('div');
    wrap.className='suggest-wrap';
    inputEl.parentNode.insertBefore(wrap,inputEl);
    wrap.appendChild(inputEl);
    const box=document.createElement('div');
    box.className='suggest-box';
    wrap.appendChild(box);
  }
  const wrap=inputEl.closest('.suggest-wrap');
  const box=wrap.querySelector('.suggest-box');

  function render(){
    const items=top5(fieldKey);
    if(!items.length){ box.style.display='none'; box.innerHTML=''; return; }
    box.innerHTML = items.map(v=>`<div class="suggest-item" data-val="${escapeHtml(v)}">${escapeHtml(v)}</div>`).join('')
      + `<div class="suggest-foot">√ñneriler hƒ±z i√ßindir. ƒ∞stersen kendi yazƒ±nƒ± yazabilirsin.</div>`;
    box.style.display='block';

    box.querySelectorAll('.suggest-item').forEach(it=>{
      it.addEventListener('mousedown',(e)=>{
        e.preventDefault();
        inputEl.value = it.getAttribute('data-val')||'';
        onUserRealInput();
        guncelleVeAutoSave();
        box.style.display='none';
      });
    });
  }
  function hide(delay=120){ setTimeout(()=>box.style.display='none',delay); }

  inputEl.addEventListener('focus', ()=>render()); // sadece g√∂ster
  inputEl.addEventListener('blur', ()=>hide());
  inputEl.addEventListener('input', ()=>{ onUserRealInput(); render(); });

  document.addEventListener('click',(e)=>{ if(!wrap.contains(e.target)) box.style.display='none'; });
}

function hmaxHesapla(){
  const kat=parseFloat(document.getElementById('kat-sayisi').value);
  document.getElementById('hmax-output').textContent = (!isNaN(kat) && kat>0) ? `(Hmax: ${(kat*3+0.5).toFixed(1)} m)` : "";
}

function guncelle(){
  const planIsmi = document.getElementById('imar-plani-ismi').value || '...';
  const nizamRadio = document.querySelector('input[name="nizam"]:checked');
  const nizamVal = nizamRadio ? nizamRadio.value : "";
  const nizam = nizamVal === 'Diƒüer' ? (document.getElementById('diƒüer-nizam-kutusu').value || '...') : (nizamVal || '...');

  const kat = document.getElementById('kat-sayisi').value || "...";
  const taks = document.getElementById('taks').value || "...";
  const kaks = document.getElementById('kaks').value || "...";

  const terk = parseFloat(document.getElementById('yola-terk').value) || 0;
  const tecavuz = document.querySelector('input[name="tecavuz"]:checked')?.value || 'Hayƒ±r';
  const tecavuzM = tecavuz === 'Evet' ? (document.getElementById('yola-tecav√ºz-alan-kutusu').value || 0) : 0;

  const kentsel = document.querySelector('input[name="kentsel"]:checked')?.value || 'Hayƒ±r';
  const riskli = document.querySelector('input[name="riskli"]:checked')?.value || 'Hayƒ±r';

  document.getElementById('tecavuz-sorusu').style.display = terk > 0 ? 'block' : 'none';
  document.getElementById('diƒüer-nizam-kutusu').style.display = nizamVal === 'Diƒüer' ? 'inline' : 'none';
  document.getElementById('yola-tecav√ºz-alan-kutusu').style.display = tecavuz === 'Evet' ? 'inline' : 'none';

  document.getElementById('banka-tablo-output').innerHTML = `
    <tr><td><b>ƒ∞MAR PLANI ƒ∞SMƒ∞</b></td><td>${escapeHtml(planIsmi)}</td></tr>
    <tr><td><b>YAPI Nƒ∞ZAMI</b></td><td>${escapeHtml(nizam)}</td></tr>
    <tr><td><b>KAT ADEDƒ∞</b></td><td>${escapeHtml(kat)} Kat</td></tr>
    <tr><td><b>TAKS / KAKS</b></td><td>${escapeHtml(taks)} / ${escapeHtml(kaks)}</td></tr>
    <tr><td><b>YOLA TERK</b></td><td>${escapeHtml(String(terk))} m¬≤</td></tr>
    <tr><td><b>TECAV√úZ</b></td><td>${tecavuz === 'Evet' ? escapeHtml(String(tecavuzM))+' m¬≤' : 'Yok'}</td></tr>
    <tr><td><b>KENTSEL D√ñN√ú≈û√úM</b></td><td>${escapeHtml(kentsel.toUpperCase())}</td></tr>
    <tr><td><b>Rƒ∞SKLƒ∞ YAPI</b></td><td>${escapeHtml(riskli.toUpperCase())}</td></tr>
  `;

  const tecavuzMetni = terk > 0
    ? (tecavuz === 'Evet'
      ? `Ta≈üƒ±nmaz parselinin ${terk} m¬≤ yola terki bulunmakta olup, i√ßindeki yapƒ±larƒ±n ${tecavuzM} m¬≤ tecav√ºz√º s√∂z konusudur.`
      : `Ta≈üƒ±nmaz parselinin ${terk} m¬≤ yola terki bulunmakta olup, i√ßindeki yapƒ±larda yola tecav√ºz bulunmamaktadƒ±r.`)
    : `Ta≈üƒ±nmaz parselinin yola terki bulunmamaktadƒ±r.`;

  const belediye = (report.ilce || 'ƒ∞lgili') + " Belediyesi";
  const raporMetni = `${belediye} ${planIsmi} uygulama imar planƒ± i√ßerisinde yer almakta olup, ${nizam} Nizam, ${kat} Kat, Taks: ${taks} - Kaks: ${kaks} yapƒ±la≈üma ≈üartlarƒ±ndadƒ±r. ${tecavuzMetni} ƒ∞mar M√ºd√ºrl√ºƒü√º'nden parselin kentsel d√∂n√º≈ü√ºm alanƒ±nda ${kentsel === 'Evet' ? 'olduƒüu' : 'olmadƒ±ƒüƒ±'} ve riskli yapƒ± ilan ${riskli === 'Evet' ? 'edildiƒüi' : 'edilmediƒüi'} bilgisi alƒ±nmƒ±≈ütƒ±r.`;

  document.getElementById('rapor-metni-output').textContent = raporMetni;
  return { metin: raporMetni, tablo: document.getElementById('banka-tablo-output').innerHTML };
}

function computeComplete(){
  const plan = norm(document.getElementById('imar-plani-ismi').value);
  const nizamRadio = document.querySelector('input[name="nizam"]:checked');
  const kat = norm(document.getElementById('kat-sayisi').value);
  const taks = norm(document.getElementById('taks').value);
  const kaks = norm(document.getElementById('kaks').value);
  return !!(plan && nizamRadio && kat && taks && kaks);
}

let autosaveTimer=null;
function guncelleVeAutoSave(){
  guncelle();
  clearTimeout(autosaveTimer);
  autosaveTimer=setTimeout(()=>kaydet(true), 500);
}

function kaydet(silent=true){
  const data=guncelle();
  const mod=ensureModuleState();

  const eksikVar = !computeComplete();
  if(!silent && eksikVar){
    if(!confirm("‚ö†Ô∏è Kritik imar verileri (ƒ∞sim, Nizam, Kat, Taks/Kaks) eksik. Yine de 'Eksik Veri' olarak kaydedilsin mi?")) return;
  }

  const nizamRadio = document.querySelector('input[name="nizam"]:checked');

  report.imar = {
    imarPlaniIsmi: document.getElementById('imar-plani-ismi').value,
    nizam: nizamRadio ? nizamRadio.value : "",
    nizamDiger: document.getElementById('diƒüer-nizam-kutusu').value,
    kat: document.getElementById('kat-sayisi').value,
    taks: document.getElementById('taks').value,
    kaks: document.getElementById('kaks').value,
    terk: document.getElementById('yola-terk').value,
    tecavuz: document.querySelector('input[name="tecavuz"]:checked')?.value || 'Hayƒ±r',
    tecavuzMiktar: document.getElementById('yola-tecav√ºz-alan-kutusu').value,
    kentsel: document.querySelector('input[name="kentsel"]:checked')?.value || 'Hayƒ±r',
    riskli: document.querySelector('input[name="riskli"]:checked')?.value || 'Hayƒ±r'
  };

  report.imarMetni = data.metin;
  report.imarTablo = `<table>${data.tablo}</table>`;

  mod.complete = !eksikVar;
  if(!silent) mod.savedAt = Date.now();
  report.imar_tamamlandi = !!(mod.savedAt && mod.complete);

  report.modules[MODULE_KEY] = { ...mod, ...report.imar, imarMetni: report.imarMetni, imarTablo: report.imarTablo };
  report.updatedAt = Date.now();

  if(!silent){
    addSuggestion(`${MODULE_KEY}.imar_ismi`, report.imar.imarPlaniIsmi);
    addSuggestion(`${MODULE_KEY}.nizam_diger`, report.imar.nizamDiger);
    addSuggestion(`${MODULE_KEY}.taks`, report.imar.taks);
    addSuggestion(`${MODULE_KEY}.kaks`, report.imar.kaks);
  }

  persist();

  if(!silent){
    const box=document.getElementById('statusBox');
    box.style.display='block';
    box.style.backgroundColor = eksikVar ? '#fff3cd' : '#d1e7dd';
    box.style.color = eksikVar ? '#856404' : '#0f5132';
    box.textContent = eksikVar ? "‚ö†Ô∏è EKSƒ∞K VERƒ∞YLE KAYDEDƒ∞LDƒ∞ (Taslak)" : "‚úÖ ƒ∞MAR DURUMU KAYDEDƒ∞LDƒ∞ (Tamam)";
    setTimeout(()=>box.style.display='none', 2500);
  }
}

function anaMenuyeDon(){ window.location.href = `rapor-detay.html?id=${id}`; }

function bindEvents(){
  const imarIsmi=document.getElementById('imar-plani-ismi');
  const nizamDiger=document.getElementById('diƒüer-nizam-kutusu');
  const taks=document.getElementById('taks');
  const kaks=document.getElementById('kaks');

  attachSuggest(imarIsmi, `${MODULE_KEY}.imar_ismi`);
  attachSuggest(nizamDiger, `${MODULE_KEY}.nizam_diger`);
  attachSuggest(taks, `${MODULE_KEY}.taks`);
  attachSuggest(kaks, `${MODULE_KEY}.kaks`);

  imarIsmi.addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });
  nizamDiger.addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });
  taks.addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });
  kaks.addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });

  document.getElementById('kat-sayisi').addEventListener('input', ()=>{ onUserRealInput(); hmaxHesapla(); guncelleVeAutoSave(); });
  document.getElementById('yola-terk').addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });
  document.getElementById('yola-tecav√ºz-alan-kutusu').addEventListener('input', ()=>{ onUserRealInput(); guncelleVeAutoSave(); });

  document.querySelectorAll('input[name="nizam"]').forEach(r=>r.addEventListener('change', ()=>{ onUserRealInput(); guncelleVeAutoSave(); }));
  document.querySelectorAll('input[name="tecavuz"]').forEach(r=>r.addEventListener('change', ()=>{ onUserRealInput(); guncelleVeAutoSave(); }));
  document.querySelectorAll('input[name="kentsel"]').forEach(r=>r.addEventListener('change', ()=>{ onUserRealInput(); guncelleVeAutoSave(); }));
  document.querySelectorAll('input[name="riskli"]').forEach(r=>r.addEventListener('change', ()=>{ onUserRealInput(); guncelleVeAutoSave(); }));
}

function loadFromReport(){
  document.getElementById('raporBilgi').textContent = report.propertyName || "Rapor Bilgisi";
  const i=report.imar || {};

  document.getElementById('imar-plani-ismi').value = i.imarPlaniIsmi || "";
  document.getElementById('kat-sayisi').value = i.kat || "";
  document.getElementById('taks').value = i.taks || "";
  document.getElementById('kaks').value = i.kaks || "";
  document.getElementById('yola-terk').value = i.terk || 0;

  if(i.nizam){
    const rN=document.querySelector(`input[name="nizam"][value="${i.nizam}"]`);
    if(rN) rN.checked=true;
    if(i.nizam==='Diƒüer'){
      document.getElementById('diƒüer-nizam-kutusu').style.display='inline';
      document.getElementById('diƒüer-nizam-kutusu').value = i.nizamDiger || '';
    }
  }

  if(i.tecavuz){
    const rT=document.querySelector(`input[name="tecavuz"][value="${i.tecavuz}"]`);
    if(rT) rT.checked=true;
    if(i.tecavuz==='Evet'){
      document.getElementById('yola-tecav√ºz-alan-kutusu').style.display='inline';
      document.getElementById('yola-tecav√ºz-alan-kutusu').value = i.tecavuzMiktar || '';
    }
  }

  if(i.kentsel){
    const rK=document.querySelector(`input[name="kentsel"][value="${i.kentsel}"]`);
    if(rK) rK.checked=true;
  }
  if(i.riskli){
    const rR=document.querySelector(`input[name="riskli"][value="${i.riskli}"]`);
    if(rR) rR.checked=true;
  }

  hmaxHesapla();
  guncelle();
  setBadge(computeStatus(ensureModuleState()));
}

window.onload = function(){
  bindEvents();
  loadFromReport();
};
</script>
</body>
</html>
