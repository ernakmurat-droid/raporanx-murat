<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Raporan X - Emsal ModÃ¼lÃ¼</title>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <style>
    :root { --primary:#1a237e; --secondary:#3f51b5; --success:#2e7d32; --bg:#f4f7f6; }
    body { font-family:'Segoe UI', sans-serif; background:var(--bg); margin:0; padding-bottom:50px; }
    .header { background:var(--primary); color:#fff; padding:20px; text-align:center; }
    .container { max-width:900px; margin:20px auto; padding:0 20px; }
    .card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.1); margin-bottom:20px; }
    
    /* KOPYALANABÄ°LÄ°R ALAN AYARLARI */
    .final-box {
      background:#fff; border:2px solid #ddd; padding:20px; border-radius:12px;
      white-space:pre-wrap; font-size:15px; line-height:1.6; color:#333;
      user-select: text !important; /* SEÃ‡Ä°LEBÄ°LÄ°R YAPILDI */
      -webkit-user-select: text !important;
      cursor: text;
    }

    .btn-copy {
      background: #ff9800; color: white; border: none; padding: 10px 20px;
      border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
      width: 100%; display: block;
    }

    .input-group { margin-bottom: 15px; }
    .input-group label { display:block; font-size:13px; font-weight:600; margin-bottom:5px; }
    .input-group input { width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; }
    .hidden { display:none; }
    .emsal-item { background:#f1f3f4; padding:10px; border-radius:8px; margin-bottom:5px; display:flex; justify-content:space-between; }
  </style>
</head>

<body>
  <div class="header">
    <h1>EMSAL ANALÄ°Z METÄ°NLERÄ°</h1>
  </div>

  <div class="container">
    <div class="card">
      <h3>Emsal Veri GiriÅŸi</h3>
      <div class="input-group">
        <label>Emsal KaynaÄŸÄ± (Sahibinden, EmlakÃ§Ä± vb.)</label>
        <input type="text" id="kaynak" placeholder="Ã–rn: Sahibinden.com">
      </div>
      <div class="input-group">
        <label>Emsal Fiyat (TL)</label>
        <input type="number" id="fiyat" oninput="otomatikMetin()">
      </div>
      <div class="input-group">
        <label>Emsal Alan (mÂ²)</label>
        <input type="number" id="alan" oninput="otomatikMetin()">
      </div>
      <button onclick="emsalEkle()" style="background:var(--success); color:white; border:none; padding:10px; border-radius:8px; width:100%;">LÄ°STEYE EKLE</button>
    </div>

    <div id="liste" style="margin-bottom:20px;"></div>

    <h3>OluÅŸan Rapor Metni (Kopyalanabilir)</h3>
    <button class="btn-copy" onclick="kopyala()">ðŸ“‹ METNÄ° PANoya KOPYALA</button>
    <div id="finalMetin" class="final-box">HenÃ¼z veri girilmedi...</div>
  </div>

  <script>
    let emsaller = [];

    function emsalEkle() {
      const k = document.getElementById('kaynak').value;
      const f = document.getElementById('fiyat').value;
      const a = document.getElementById('alan').value;
      
      if(!f || !a) return alert("Fiyat ve Alan giriniz!");

      const birim = Math.round(f / a);
      emsaller.push({ kaynak: k, fiyat: f, alan: a, birim: birim });
      
      document.getElementById('kaynak').value = "";
      document.getElementById('fiyat').value = "";
      document.getElementById('alan').value = "";
      
      listele();
      otomatikMetin();
    }

    function listele() {
      const div = document.getElementById('liste');
      div.innerHTML = emsaller.map((e, i) => `
        <div class="emsal-item">
          <span>${e.kaynak} - ${e.fiyat} TL (${e.birim} TL/mÂ²)</span>
          <button onclick="sil(${i})" style="color:red; border:none; background:none; cursor:pointer;">Sil</button>
        </div>
      `).join('');
    }

    function sil(i) {
      emsaller.splice(i, 1);
      listele();
      otomatikMetin();
    }

    function otomatikMetin() {
      if(emsaller.length === 0) {
        document.getElementById('finalMetin').innerText = "Veri bekleniyor...";
        return;
      }

      let m = "EMSAL KARÅžILAÅžTIRMA ANALÄ°ZÄ°\n\n";
      m += "DeÄŸerleme konusu taÅŸÄ±nmazÄ±n konumlandÄ±ÄŸÄ± bÃ¶lgede yapÄ±lan saha araÅŸtÄ±rmalarÄ± sonucunda aÅŸaÄŸÄ±daki emsal verilerine ulaÅŸÄ±lmÄ±ÅŸtÄ±r:\n\n";
      
      emsaller.forEach((e, idx) => {
        m += `${idx+1}. Emsal: ${e.kaynak} aracÄ±lÄ±ÄŸÄ±yla Ã¶ÄŸrenilen taÅŸÄ±nmaz ${e.alan} mÂ² olup ${new Intl.NumberFormat('tr-TR').format(e.fiyat)} TL bedelle satÄ±ÅŸa sunulmuÅŸtur. (Birim: ${new Intl.NumberFormat('tr-TR').format(e.birim)} TL/mÂ²)\n`;
      });

      m += "\nTespit edilen emsallerin konum, ÅŸerefiye ve pazarlÄ±k paylarÄ± revize edildiÄŸinde, bÃ¶lgedeki mÂ² birim deÄŸerlerinin taÅŸÄ±nmazÄ±n Ã¶zellikleri ile uyumlu olduÄŸu gÃ¶rÃ¼lmÃ¼ÅŸtÃ¼r.";
      
      document.getElementById('finalMetin').innerText = m;
    }

    function kopyala() {
      const metin = document.getElementById('finalMetin').innerText;
      navigator.clipboard.writeText(metin).then(() => {
        alert("Metin panoya kopyalandÄ±! Ä°stediÄŸin yere (Word, WhatsApp, Rapor) yapÄ±ÅŸtÄ±rabilirsin.");
      });
    }

    function sil(idx) {
        emsaller.splice(idx, 1);
        listele();
        otomatikMetin();
    }
  </script>
</body>
</html>
