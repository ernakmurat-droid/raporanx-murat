<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaporAn X Taşınmaz Değerleme Sistemi</title>
    <link rel="manifest" href="manifest.json">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(to bottom, #4a148c, #7c4dff); margin: 0; padding: 40px 20px; color: white; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; text-align: center; }
        h1 { font-size: 42px; margin-bottom: 10px; font-weight: 900; letter-spacing: -1px; }
        h1 span { color: #ff0000; }
        .slogan { font-size: 22px; margin: 10px 0 40px 0; opacity: 0.95; font-style: italic; font-weight: 300; letter-spacing: 1px; }
        .auth-section { background: rgba(0,0,0,0.2); padding: 30px; border-radius: 25px; margin-bottom: 30px; }
        .user-info { margin-bottom: 20px; font-size: 16px; opacity: 0.9; }
        .btn-google { display: block; width: 350px; max-width: 90%; margin: 10px auto; background: white; color: #444; padding: 15px; text-align: center; font-size: 18px; font-weight: bold; text-decoration: none; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s; border: none; cursor: pointer; }
        .btn-new { display: block; width: 400px; max-width: 90%; margin: 20px auto; background: #00c853; color: white; padding: 25px; text-align: center; font-size: 28px; font-weight: bold; text-decoration: none; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .report-card { background: rgba(255,255,255,0.25); padding: 25px; border-radius: 15px; margin-bottom: 15px; text-align: left; cursor: pointer; position: relative; }
        .delete-btn { position: absolute; top: 15px; right: 15px; background: #d32f2f; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
        .btn-logout { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>RAPORAN <span>X</span></h1>
    <p class="slogan">“Çok karakteristik, çok abuzittik!”</p>
    
    <div class="auth-section">
        <div id="userInfo" class="user-info">Sistem kontrol ediliyor...</div>
        <button id="loginBtn" class="btn-google" onclick="loginWithGoogle()" style="display:none;">Google ile Giriş Yap</button>
    </div>

    <div id="mainContent" style="display:none;">
        <div id="reportCount" style="font-size: 20px; margin-bottom: 20px;">Toplam kayıt: 0</div>
        <a href="yeni_kayit.html" class="btn-new">YENİ DEĞERLEME DOSYASI AÇ</a>
        <div id="reportsList"></div>
    </div>
</div>

<script>
    // 1. Firebase Yapılandırması
    const firebaseConfig = {
        apiKey: "AIzaSyCMwx6S6rq1lnNJuHOxc38ij3qU4ankSxs",
        authDomain: "raporanx.firebaseapp.com",
        projectId: "raporanx",
        storageBucket: "raporanx.firebasestorage.app",
        messagingSenderId: "715194328346",
        appId: "1:715194328346:web:46f0bb98941e01ead6f8a3",
        measurementId: "G-V749P1HB80"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // 2. Giriş Durumu Takibi
    auth.onAuthStateChanged((user) => {
        const loginBtn = document.getElementById('loginBtn');
        const userInfo = document.getElementById('userInfo');
        const mainContent = document.getElementById('mainContent');

        if (user) {
            loginBtn.style.display = 'none';
            mainContent.style.display = 'block';
            userInfo.innerHTML = `Bağlı Hesap: ${user.email} <br> <button class="btn-logout" onclick="auth.signOut().then(()=>location.reload())">Çıkış Yap</button>`;
            loadReports();
        } else {
            loginBtn.style.display = 'block';
            mainContent.style.display = 'none';
            userInfo.innerHTML = "Lütfen devam etmek için giriş yapın.";
        }
    });

    // 3. Google Giriş Fonksiyonu
    function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
            alert("Giriş Hatası: " + error.message);
        });
    }

    // 4. Raporları Listeleme
    function loadReports() {
        let reports = JSON.parse(localStorage.getItem('gayrimenkul_reports')) || [];
        const list = document.getElementById('reportsList');
        document.getElementById('reportCount').textContent = `Toplam kayıt: ${reports.length}`;
        
        if (reports.length === 0) {
            list.innerHTML = '<p>Henüz kayıt bulunamadı.</p>';
            return;
        }

        list.innerHTML = '';
        reports.forEach((report, index) => {
            const card = document.createElement('div');
            card.className = 'report-card';
            card.innerHTML = `
                <button class="delete-btn" onclick="deleteReport(${index}, event)">Sil</button>
                <div style="font-size:20px; font-weight:bold;">${report.propertyName || 'İsimsiz Kayıt'}</div>
                <div>${report.il || ''} / ${report.ilce || ''}</div>
                <small>Tarih: ${report.createdAt || 'Belirtilmedi'}</small>
            `;
            card.onclick = (e) => {
                if (!e.target.classList.contains('delete-btn')) {
                    window.location.href = `rapor-detay.html?id=${index}`;
                }
            };
            list.appendChild(card);
        });
    }

    function deleteReport(index, event) {
        event.stopPropagation();
        if (confirm('Silmek istediğinize emin misiniz?')) {
            let reports = JSON.parse(localStorage.getItem('gayrimenkul_reports')) || [];
            reports.splice(index, 1);
            localStorage.setItem('gayrimenkul_reports', JSON.stringify(reports));
            loadReports();
        }
    }
</script>
</body>
</html>