<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Konum ve Ã‡evre Ã–zellikleri</title>
<style>
    :root { --primary: #1a237e; --secondary: #3f51b5; --success: #00c853; --bg: #f4f7f6; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin:0; padding-bottom:50px; }
    .header { background: linear-gradient(135deg, var(--primary), var(--secondary)); color:white; padding:15px; text-align:center; position:sticky; top:0; z-index:1000; }
    .back { position:absolute; left:10px; top:12px; background:#d32f2f; padding:8px 12px; border-radius:12px; color:white; text-decoration:none; border: none; cursor: pointer; }
    .main-wrapper { display: flex; flex-direction: column; max-width: 1000px; margin: 15px auto; gap: 15px; padding: 0 15px; }
    .form-container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .grid-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .section-title { grid-column: span 2; border-left: 5px solid var(--primary); margin-top: 20px; padding-left: 10px; color: var(--primary); font-weight: bold; background: #f0f2ff; padding: 8px; border-radius: 0 8px 8px 0; }
    .input-item { display: flex; flex-direction: column; }
    .input-item label { font-weight: 600; font-size: 13px; color: #444; margin-bottom: 5px; }
    input, textarea { padding:12px; border:1px solid #ccc; border-radius:10px; font-size:15px; background: #fff; transition: 0.3s; width: 100%; box-sizing: border-box; }
    input:focus { border-color: var(--primary); box-shadow: 0 0 8px rgba(26,35,126,0.1); outline: none; }
    .radio-group { display: flex; gap: 20px; padding: 10px 0; }
    .radio-item { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .full-width { grid-column: span 2; }
    .btn-save { background: var(--success); color: white; padding: 20px; border: none; border-radius: 15px; width: 100%; font-weight: bold; font-size: 18px; cursor: pointer; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,200,83,0.3); }
    .btn-back { background: #6c757d; color: white; padding: 20px; border: none; border-radius: 15px; width: 100%; font-weight: bold; font-size: 18px; cursor: pointer; margin-top: 10px; }
    
    .preview-box { 
        background: #333; color: #00ff00; padding: 20px; border-radius: 15px; 
        font-family: 'Courier New', monospace; white-space: pre-wrap; font-size: 13px; 
        margin-top: 20px; border: 2px solid #555;
        transition: filter 0.3s ease;
    }
    .preview-box:not(:hover) { filter: blur(1.5px); }
    .disabled-input { background: #eee; cursor: not-allowed; }
    .save-status { display: none; text-align: center; font-weight: bold; margin-top: 15px; padding: 10px; border-radius: 10px; }
</style>
</head>
<body oncontextmenu="return false;">

<div class="header">
    <button onclick="anaMenuyeDon()" class="back">â† MenÃ¼ye DÃ¶n</button>
    <h1>KONUM VE Ã‡EVRESEL Ã–ZELLÄ°KLER</h1>
    <div id="raporBilgi" style="font-size: 12px; opacity: 0.8;">YÃ¼kleniyor...</div>
</div>

<div class="main-wrapper">
    <div class="form-container">
        <form id="mainForm" onsubmit="return false;">
            <div class="grid-form">
                <div class="section-title">ğŸ“Š TABLO VERÄ°LERÄ° (1-16)</div>
                <div class="input-item"><label>(1) UAVT</label><input type="text" id="v1" list="h_v1" onfocus="showList(this)"></div>
                <div class="input-item"><label>(2) Koordinat X</label><input type="text" id="v2" list="h_v2" onfocus="showList(this)"></div>
                <div class="input-item"><label>(3) Koordinat Y</label><input type="text" id="v3" list="h_v3" onfocus="showList(this)"></div>
                <div class="input-item"><label>(4) Ä°li</label><input type="text" id="v4" list="h_v4" onfocus="showList(this)"></div>
                <div class="input-item"><label>(5) Ä°lÃ§esi</label><input type="text" id="v5" list="h_v5" onfocus="showList(this)"></div>
                <div class="input-item"><label>(6) Mahallesi</label><input type="text" id="v6" list="h_v6" onfocus="showList(this)"></div>
                <div class="input-item"><label>(7) Cadde/Sokak</label><input type="text" id="v7" list="h_v7" onfocus="showList(this)"></div>
                <div class="input-item"><label>(8) DÄ±ÅŸ KapÄ± No</label><input type="text" id="v8" list="h_v8" onfocus="showList(this)"></div>
                <div class="input-item"><label>(9) BulunduÄŸu Kat</label><input type="text" id="v9" list="h_v9" onfocus="showList(this)"></div>
                <div class="input-item"><label>(10) Daire No</label><input type="text" id="v10" list="h_v10" onfocus="showList(this)"></div>
                <div class="input-item"><label>(11) BÃ¶lge GeliÅŸimi</label><input type="text" id="v11" list="h_v11" onfocus="showList(this)"></div>
                <div class="input-item"><label>(12) BÃ¶lge YapÄ±laÅŸmasÄ±</label><input type="text" id="v12" list="h_v12" onfocus="showList(this)"></div>
                <div class="input-item"><label>(13) YapÄ± Tipleri</label><input type="text" id="v13" list="h_v13" onfocus="showList(this)"></div>
                <div class="input-item"><label>(14) Gelir DÃ¼zeyi</label><input type="text" id="v14" list="h_v14" onfocus="showList(this)"></div>
                <div class="input-item"><label>(15) YakÄ±n YapÄ± 1</label><input type="text" id="v15" list="h_v15" onfocus="showList(this)"></div>
                <div class="input-item"><label>(16) YakÄ±n YapÄ± 2</label><input type="text" id="v16" list="h_v16" onfocus="showList(this)"></div>
                
                <div class="section-title">ğŸ“ KUTSAL METÄ°N DEÄÄ°ÅKENLERÄ°</div>
                <div class="input-item full-width"><label>UlaÅŸÄ±m Tarifi</label><textarea id="ulasimTarifi" rows="3" list="h_ulasimTarifi" onfocus="showList(this)"></textarea></div>
                <div class="input-item full-width"><label>UlaÅŸÄ±m OlanaklarÄ±</label><input type="text" id="ulasimOlanaklari" list="h_ulasimOlanaklari" onfocus="showList(this)"></div>
                
                <div class="input-item">
                    <label>AltyapÄ± Durumu</label>
                    <div class="radio-group">
                        <label class="radio-item"><input type="radio" name="altyapi" value="Evet" checked onclick="toggleAltyapi(true)"> Evet</label>
                        <label class="radio-item"><input type="radio" name="altyapi" value="HayÄ±r" onclick="toggleAltyapi(false)"> HayÄ±r</label>
                    </div>
                </div>
                <div class="input-item">
                    <label>AltyapÄ± AÃ§Ä±klamasÄ±</label>
                    <input type="text" id="altyapiAciklama" class="disabled-input" disabled list="h_altyapiAciklama" onfocus="showList(this)">
                </div>
            </div>
        </form>
        <div class="section-title">ğŸ‘€ CANLI Ã–NÄ°ZLEME (RAPORDA BÃ–YLE GÃ–RÃœNECEK)</div>
        <div class="preview-box" id="livePreview" oncopy="return false">Veri bekleniyor</div>
        
        <button class="btn-save" onclick="verileriKaydet()">VERÄ°LERÄ° KAYDET (SAYFADA KAL)</button>
        <div id="statusMsg" class="save-status"></div>
        <button class="btn-back" onclick="anaMenuyeDon()">MENÃœYE DÃ–N</button>
    </div>
</div>

<div id="datalists">
    <datalist id="h_v1"></datalist><datalist id="h_v2"></datalist><datalist id="h_v3"></datalist>
    <datalist id="h_v4"></datalist><datalist id="h_v5"></datalist><datalist id="h_v6"></datalist>
    <datalist id="h_v7"></datalist><datalist id="h_v8"></datalist><datalist id="h_v9"></datalist>
    <datalist id="h_v10"></datalist><datalist id="h_v11"></datalist><datalist id="h_v12"></datalist>
    <datalist id="h_v13"></datalist><datalist id="h_v14"></datalist><datalist id="h_v15"></datalist>
    <datalist id="h_v16"></datalist><datalist id="h_ulasimTarifi"></datalist>
    <datalist id="h_ulasimOlanaklari"></datalist><datalist id="h_altyapiAciklama"></datalist>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id') || 0;
    let reports = JSON.parse(localStorage.getItem('gayrimenkul_reports')) || [];
    let report = reports[id] || {};
    const inputIds = ['v1','v2','v3','v4','v5','v6','v7','v8','v9','v10','v11','v12','v13','v14','v15','v16','ulasimTarifi','ulasimOlanaklari','altyapiAciklama'];

    function showList(input) {
        input.setAttribute('autocomplete', 'off');
        const val = input.value;
        input.value = '';
        setTimeout(() => { input.value = val; }, 1);
    }

    function toggleAltyapi(isEvet) {
        const input = document.getElementById('altyapiAciklama');
        if(isEvet) {
            input.disabled = true;
            input.classList.add('disabled-input');
            input.value = "";
        } else {
            input.disabled = false;
            input.classList.remove('disabled-input');
        }
        guncelleOnizleme();
    }

    function guncelleOnizleme() {
        let v = {};
        inputIds.forEach(id => { v[id] = document.getElementById(id).value || "..."; });
        
        let yapiTipi = v.v13.trim();
        let yapiTipiMetni = yapiTipi;
        if (yapiTipi !== "..." && !yapiTipi.toLowerCase().includes("tip") && !yapiTipi.toLowerCase().includes("yapÄ±")) {
            yapiTipiMetni = yapiTipi + " tipi yapÄ±lar";
        }

        const altyapiTik = document.querySelector('input[name="altyapi"]:checked').value;
        const altyapiMetni = altyapiTik === "Evet" ? "alt yapÄ±sÄ± tamamlanmÄ±ÅŸtÄ±r" : (v.altyapiAciklama || "...");
        
        let tablo = "------------------------------------------\n Ã‡EVRESEL Ã–ZELLÄ°KLER TABLOSU\n------------------------------------------\n";
        const labels = ["UAVT","Koord X","Koord Y","Ä°li","Ä°lÃ§esi","Mahallesi","Cadde/Sokak","DÄ±ÅŸ KapÄ± No","Bul. Kat","Daire No","BÃ¶lge GeliÅŸimi","YapÄ±laÅŸma","YapÄ± Tipleri","Gelir DÃ¼zeyi","YakÄ±n YapÄ± 1","YakÄ±n YapÄ± 2"];
        for(let i=1; i<=16; i++) {
            tablo += `${labels[i-1].padEnd(20, ' ')} : ${v['v'+i]}\n`;
        }

        const f1 = `KONUMU VE Ã‡EVRESEL Ã–ZELLÄ°KLERÄ° (Format 1)\nDeÄŸerlemeye konu taÅŸÄ±nmaz, ${v.v4} ili, ${v.v5} Ä°lÃ§esi, ${v.v6} Mahallesi ${v.v7}, No: ${v.v8}/${v.v10} posta adresinde yer almaktadÄ±r. TaÅŸÄ±nmaza ulaÅŸÄ±m; ${v.ulasimTarifi}. BÃ¶lge genelde yapÄ± kalitesine baÄŸlÄ± olarak, ${v.v14} gelir grubu tarafÄ±ndan yerleÅŸim amaÃ§lÄ± olarak talep gÃ¶rmektedir. BÃ¶lge Ã§evresinde ${v.v12} katlÄ± ${yapiTipiMetni} bulunmaktadÄ±r. ${v.ulasimOlanaklari} TaÅŸÄ±nmazÄ±n yakÄ±n Ã§evresinde ${v.v15} ve ${v.v16} yer almaktadÄ±r.\n\nBÃ¶lgenin GeliÅŸimine Ä°liÅŸkin Analiz\nTaÅŸÄ±nmaza bulunduÄŸu bÃ¶lge ${v.v14} grubunun yerleÅŸim iÃ§in tercih ettiÄŸi bir bÃ¶lgedir. TaÅŸÄ±nmazÄ±n bulunduÄŸu bÃ¶lgede yapÄ±laÅŸma ${v.v11} ÅŸeklindedir.`;
        
        const f2 = `TAÅINMAZIN YERÄ° VE Ã‡EVRE Ã–ZELLÄ°KLERÄ° (Format 2)\nDeÄŸerlemesi yapÄ±lan gayrimenkul, ${v.v6} Mahallesi, ${v.v7}, No: ${v.v8}, Kat: ${v.v9} Daire: ${v.v10}, ${v.v5}/${v.v4} aÃ§Ä±k posta adresinde yer almaktadÄ±r. GayrimenkulÃ¼n bulunduÄŸu bÃ¶lgede ${v.v12} nitelikli ${yapiTipiMetni} bulunmaktadÄ±r. UlaÅŸÄ±m iÃ§in; ${v.ulasimTarifi}.`;
        
        const f3 = `ULAÅIM TARÄ°FÄ° (Format 3)\nDeÄŸerleme konusu taÅŸÄ±nmaz, ${v.v4} Ä°li, ${v.v5} Ä°lÃ§esi, ${v.v6} Mahallesi, ${v.v7}, No: ${v.v8}/${v.v10} posta adresinde yer almaktadÄ±r. DeÄŸerleme konusu taÅŸÄ±nmaza ulaÅŸÄ±m; ${v.ulasimTarifi}. PlanlÄ± yapÄ±laÅŸmaya sahip bÃ¶lgenin (yol, su, elektrik, kanalizasyon, doÄŸalgaz) ${altyapiMetni}. ${v.ulasimOlanaklari}`;
        
        const tamPaket = tablo + "\n" + f1 + "\n\n" + f2 + "\n\n" + f3;
        document.getElementById('livePreview').textContent = tamPaket;
        return tamPaket;
    }

    function verileriKaydet() {
        const paket = guncelleOnizleme();
        let v = {};
        inputIds.forEach(id => { v[id] = document.getElementById(id).value.trim(); });
        
        // --- TEKNÄ°K VERÄ° KONTROLÃœ ---
        const kritikAlanlar = ['v1', 'v2', 'v4', 'v5', 'v6', 'ulasimTarifi'];
        let eksikVar = kritikAlanlar.some(field => !v[field] || v[field] === "...");

        if (eksikVar) {
            if (!confirm("âš ï¸ BazÄ± teknik veriler (UAVT, Ä°l, Ä°lÃ§e, Mahalle veya Tarif) boÅŸ bÄ±rakÄ±ldÄ±.\n\nEksik verilerle 'SarÄ± UyarÄ±' alarak kaydetmek istiyor musunuz?")) return;
        }

        v.altyapiTik = document.querySelector('input[name="altyapi"]:checked').value;
        report.konumCevre = { ...v, tamMetin: paket };
        report.konum_tamamlandi = !eksikVar;

        reports[id] = report;
        localStorage.setItem('gayrimenkul_reports', JSON.stringify(reports));

        // GÃ¶rsel geri bildirim
        const statusMsg = document.getElementById('statusMsg');
        statusMsg.style.display = 'block';
        if(eksikVar) {
            statusMsg.style.background = '#fff3cd';
            statusMsg.style.color = '#856404';
            statusMsg.textContent = "âš ï¸ Veriler eksik olarak mÃ¼hÃ¼rlendi!";
        } else {
            statusMsg.background = '#d1e7dd';
            statusMsg.style.color = '#0f5132';
            statusMsg.textContent = "âœ… TÃ¼m metinler mÃ¼hÃ¼rlendi ve kaydedildi!";
        }
        setTimeout(() => { statusMsg.style.display = 'none'; }, 3000);
    }

    function anaMenuyeDon() { window.location.href = `rapor-detay.html?id=${id}`; }

    window.onload = () => {
        document.getElementById('raporBilgi').textContent = report.propertyName || "Yeni Rapor";
        inputIds.forEach(id => {
            let h = JSON.parse(localStorage.getItem('h_' + id)) || [];
            const dl = document.getElementById('h_' + id);
            if(dl) dl.innerHTML = h.map(item => `<option value="${item}">`).join('');
        });
        if(report.konumCevre) {
            inputIds.forEach(id => {
                if(report.konumCevre[id]) document.getElementById(id).value = report.konumCevre[id];
            });
            if(report.konumCevre.altyapiTik === "HayÄ±r") toggleAltyapi(false);
        }
        guncelleOnizleme();
    };

    inputIds.forEach(id => {
        const el = document.getElementById(id);
        if(el) el.addEventListener('input', guncelleOnizleme);
    });
</script>
</body>
</html>