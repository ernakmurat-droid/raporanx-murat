<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Belgeler - Ä°ncelenen Belgeler</title>

  <style>
    :root{
      --primary:#1a148c;
      --secondary:#7c4dff;
      --success:#00c853;
      --danger:#ff1744;
      --bg:#f4f7f6;
      --card:#ffffff;
      --text:#2b2b2b;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:'Segoe UI', Tahoma, sans-serif;
      background:var(--bg);
      color:var(--text);
      padding-bottom:90px;
    }

    /* HEADER */
    .header{
      background:linear-gradient(135deg,#4a148c,#7c4dff);
      color:#fff;
      padding:18px 18px 22px 18px;
      text-align:center;
      position:sticky;
      top:0;
      z-index:20;
      box-shadow:0 2px 12px rgba(0,0,0,0.25);
    }
    .header h1{ margin:4px 0 0; font-size:20px; letter-spacing:0.2px; }
    .header p{ margin:6px 0 0; opacity:0.9; font-size:13px; }

    .back{
      position:absolute;
      left:12px;
      top:14px;
      background:rgba(255,255,255,0.22);
      color:#fff;
      border:none;
      padding:10px 14px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
    }
    .back:hover{ background:rgba(255,255,255,0.32); }

    /* LAYOUT */
    .wrap{
      max-width:980px;
      margin:18px auto;
      padding:0 14px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }

    .card{
      background:var(--card);
      border-radius:14px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      padding:16px;
    }

    .card h2{
      margin:0 0 10px;
      color:var(--primary);
      font-size:18px;
    }
    .muted{ color:#666; font-size:13px; line-height:1.5; }

    /* INPUTS (KOPYA SERBEST) */
    label{
      display:block;
      font-size:13px;
      margin:12px 0 6px;
      font-weight:600;
      color:#333;
    }
    textarea, input, select{
      width:100%;
      padding:12px;
      border:1px solid #d7d7d7;
      border-radius:10px;
      font-size:14px;
      outline:none;
      background:#fff;
      user-select:text; /* giriÅŸler kopyalanabilir */
    }
    textarea{ min-height:120px; resize:vertical; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media(max-width:700px){
      .row{ grid-template-columns:1fr; }
      .back{ position:static; margin-bottom:10px; }
      .header{ position:relative; }
    }

    /* BUTTONS */
    .btns{ display:flex; flex-wrap:wrap; gap:10px; margin-top:12px; }
    button.btn{
      border:none;
      border-radius:12px;
      padding:11px 14px;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
      transition:transform .06s ease, opacity .2s ease;
    }
    button.btn:active{ transform:scale(0.98); }
    .btn.primary{ background:var(--primary); color:#fff; }
    .btn.secondary{ background:var(--secondary); color:#fff; }
    .btn.success{ background:var(--success); color:#fff; }
    .btn.danger{ background:var(--danger); color:#fff; }
    .btn.ghost{ background:#eef0ff; color:#2a2a2a; }

    /* RAPOR (KOPYA KAPALI) */
    .rapor-kilitli{
      border-left:6px solid var(--secondary);
      user-select:none;
      -webkit-user-select:none;
      -ms-user-select:none;
      cursor:default;
    }
    .rapor-kilitli h3{
      margin:0 0 10px;
      color:var(--primary);
      font-size:18px;
    }
    .rapor-kilitli p{ margin:10px 0; line-height:1.7; }
    .rapor-kilitli ul{ margin:8px 0 0; padding-left:18px; }
    .rapor-kilitli li{ margin:6px 0; }

    .tag{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:#f0efff;
      color:#333;
      font-size:12px;
      font-weight:700;
    }

    /* ALT BAR */
    .footerbar{
      position:fixed;
      left:0; right:0; bottom:0;
      background:#ffffff;
      border-top:1px solid #e7e7e7;
      box-shadow:0 -6px 18px rgba(0,0,0,0.06);
      padding:10px 14px;
      display:flex;
      justify-content:center;
      gap:10px;
      z-index:30;
    }
    .footerbar .btn{ min-width:160px; }
  </style>
</head>

<body>
  <div class="header">
    <button class="back" onclick="history.back()">â† Geri</button>
    <h1>Belgeler</h1>
    <p>Veri giriÅŸleri serbest â€¢ Rapor metni kilitli</p>
  </div>

  <div class="wrap">

    <!-- 1) VERÄ° GÄ°RÄ°ÅÄ° (KOPYALANABÄ°LÄ°R) -->
    <div class="card">
      <h2>Belgeler â€“ Veri GiriÅŸi</h2>
      <div class="muted">
        Buradaki alanlar <b>kopyalanabilir</b>. AÅŸaÄŸÄ±da oluÅŸan rapor metni ise <b>kopyalanamaz</b>.
      </div>

      <div class="row">
        <div>
          <label>Ä°nceleme Tarihi</label>
          <input id="inpTarih" type="date" />
        </div>
        <div>
          <label>Ä°nceleme KapsamÄ±</label>
          <select id="inpKapsam">
            <option value="Genel">Genel</option>
            <option value="DetaylÄ±">DetaylÄ±</option>
            <option value="HÄ±zlÄ± Kontrol">HÄ±zlÄ± Kontrol</option>
          </select>
        </div>
      </div>

      <label>Ek AÃ§Ä±klama (opsiyonel)</label>
      <textarea id="inpAciklama" placeholder="Ã–rn: Dosya iÃ§eriÄŸi kurum yazÄ±ÅŸmalarÄ±yla karÅŸÄ±laÅŸtÄ±rÄ±lmÄ±ÅŸtÄ±r..."></textarea>

      <label>Ä°ncelenen Belgeler (opsiyonel liste)</label>
      <textarea id="inpListe" placeholder="Her satÄ±ra bir belge yaz (Ã¶rn: BaÅŸvuru Formu, SÃ¶zleÅŸme Ekleri, Teknik Rapor...)"></textarea>

      <div class="btns">
        <button class="btn primary" onclick="raporOlustur()">Rapora Aktar</button>
        <button class="btn ghost" onclick="taslakYukle()">TaslaÄŸÄ± YÃ¼kle</button>
        <button class="btn secondary" onclick="taslakKaydet()">TaslaÄŸÄ± Kaydet</button>
        <button class="btn danger" onclick="temizle()">Temizle</button>
      </div>
    </div>

    <!-- 2) RAPOR METNÄ° (KOPYALANAMAZ) -->
    <div class="card rapor-kilitli" id="raporMetni">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <h3>Ä°ncelenen Belgeler</h3>
        <span class="tag" id="tagKapsam">Kapsam: Genel</span>
      </div>

      <p id="pGiris">
        Bu rapor kapsamÄ±nda aÅŸaÄŸÄ±da listelenen belgeler incelenmiÅŸ, analiz edilmiÅŸ ve deÄŸerlendirmeye esas alÄ±nmÄ±ÅŸtÄ±r.
        Ä°nceleme sÃ¼recinde belgelerin gÃ¼ncelliÄŸi, tutarlÄ±lÄ±ÄŸÄ± ve rapor kapsamÄ±na uygunluÄŸu dikkate alÄ±nmÄ±ÅŸtÄ±r.
      </p>

      <h4 style="margin:14px 0 8px; color:#333;">Ä°ncelenen Belgeler Listesi</h4>
      <ul id="ulBelgeler">
        <li><b>BaÅŸvuru FormlarÄ±</b> â€“ Sunulan baÅŸvuru formlarÄ± incelenmiÅŸ, beyan edilen bilgiler karÅŸÄ±laÅŸtÄ±rÄ±lmÄ±ÅŸtÄ±r.</li>
        <li><b>Kimlik ve TanÄ±tÄ±cÄ± Belgeler</b> â€“ Kimlik/Ã¼nvan/yetki belgeleri doÄŸruluk aÃ§Ä±sÄ±ndan deÄŸerlendirilmiÅŸtir.</li>
        <li><b>ResmÃ® YazÄ±ÅŸmalar ve Bildirimler</b> â€“ Tebligat ve yazÄ±ÅŸmalar rapor kapsamÄ±na dahil edilmiÅŸtir.</li>
        <li><b>SÃ¶zleÅŸmeler ve Ekleri</b> â€“ YÃ¼kÃ¼mlÃ¼lÃ¼k ve ÅŸartlar aÃ§Ä±sÄ±ndan incelenmiÅŸtir.</li>
        <li><b>Teknik DokÃ¼manlar ve Raporlar</b> â€“ Ã–nceki raporlar ve teknik dokÃ¼manlar deÄŸerlendirilmiÅŸtir.</li>
        <li><b>GÃ¶rsel ve Dijital Belgeler</b> â€“ FotoÄŸraf, ekran gÃ¶rÃ¼ntÃ¼sÃ¼ ve dijital kayÄ±tlar ele alÄ±nmÄ±ÅŸtÄ±r.</li>
      </ul>

      <h4 style="margin:14px 0 8px; color:#333;">DeÄŸerlendirme Notu</h4>
      <p id="pNot">
        Ä°ncelenen belgeler, raporun hazÄ±rlanmasÄ±nda esas alÄ±nmÄ±ÅŸ olup eksik, Ã§eliÅŸkili veya doÄŸrulanamayan bilgiler
        raporun ilgili bÃ¶lÃ¼mlerinde ayrÄ±ca belirtilmiÅŸtir. Belgelerden elde edilen bulgular, objektiflik ve gizlilik
        ilkeleri Ã§erÃ§evesinde deÄŸerlendirilmiÅŸtir.
      </p>

      <div id="ekAlan" style="margin-top:14px;"></div>
    </div>

  </div>

  <!-- ALT BAR (HÄ±zlÄ± butonlar) -->
  <div class="footerbar">
    <button class="btn success" onclick="raporOlustur()">Rapora Aktar</button>
    <button class="btn secondary" onclick="taslakKaydet()">TaslaÄŸÄ± Kaydet</button>
  </div>

  <script>
    /* ==========
       1) RAPORU OLUÅTUR
       ========== */
    function raporOlustur(){
      const tarih = document.getElementById("inpTarih").value;
      const kapsam = document.getElementById("inpKapsam").value;
      const aciklama = document.getElementById("inpAciklama").value.trim();
      const listeRaw = document.getElementById("inpListe").value.trim();

      document.getElementById("tagKapsam").innerText = "Kapsam: " + kapsam;

      // Ek alan temizle
      const ekAlan = document.getElementById("ekAlan");
      ekAlan.innerHTML = "";

      // Tarih varsa ekle
      if (tarih) {
        const p = document.createElement("p");
        p.innerHTML = "<b>Ä°nceleme Tarihi:</b> " + formatDateTR(tarih);
        ekAlan.appendChild(p);
      }

      // AÃ§Ä±klama varsa ekle
      if (aciklama) {
        const p = document.createElement("p");
        p.innerHTML = "<b>Ek AÃ§Ä±klama:</b> " + escapeHtml(aciklama);
        ekAlan.appendChild(p);
      }

      // KullanÄ±cÄ± liste girdiyse, raporda ayrÄ±ca gÃ¶ster
      if (listeRaw) {
        const items = listeRaw.split("\n").map(s => s.trim()).filter(Boolean);
        if (items.length) {
          const h = document.createElement("h4");
          h.style.margin = "14px 0 8px";
          h.style.color = "#333";
          h.innerText = "KullanÄ±cÄ± TarafÄ±ndan Eklenen Belgeler";
          ekAlan.appendChild(h);

          const ul = document.createElement("ul");
          ul.style.marginTop = "8px";
          ul.style.paddingLeft = "18px";
          items.forEach(it => {
            const li = document.createElement("li");
            li.innerText = it;
            ul.appendChild(li);
          });
          ekAlan.appendChild(ul);
        }
      }
    }

    function formatDateTR(iso){
      // iso: YYYY-MM-DD
      const [y,m,d] = iso.split("-");
      return `${d}.${m}.${y}`;
    }

    function escapeHtml(str){
      return str
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /* ==========
       2) TASLAK KAYDET / YÃœKLE (localStorage)
       ========== */
    const KEY = "raporanx_belgeler_taslak_v1";

    function taslakKaydet(){
      const data = {
        inpTarih: document.getElementById("inpTarih").value,
        inpKapsam: document.getElementById("inpKapsam").value,
        inpAciklama: document.getElementById("inpAciklama").value,
        inpListe: document.getElementById("inpListe").value,
        savedAt: new Date().toISOString()
      };
      localStorage.setItem(KEY, JSON.stringify(data));
      toast("Taslak kaydedildi âœ…");
    }

    function taslakYukle(){
      const raw = localStorage.getItem(KEY);
      if(!raw){ toast("KayÄ±tlÄ± taslak yok âš ï¸"); return; }
      try{
        const data = JSON.parse(raw);
        document.getElementById("inpTarih").value = data.inpTarih || "";
        document.getElementById("inpKapsam").value = data.inpKapsam || "Genel";
        document.getElementById("inpAciklama").value = data.inpAciklama || "";
        document.getElementById("inpListe").value = data.inpListe || "";
        toast("Taslak yÃ¼klendi âœ…");
        raporOlustur();
      }catch(e){
        toast("Taslak okunamadÄ± âŒ");
      }
    }

    function temizle(){
      document.getElementById("inpTarih").value = "";
      document.getElementById("inpKapsam").value = "Genel";
      document.getElementById("inpAciklama").value = "";
      document.getElementById("inpListe").value = "";
      document.getElementById("ekAlan").innerHTML = "";
      toast("Temizlendi ğŸ§¹");
    }

    /* ==========
       3) RAPOR ALANINDA KOPYALAMA ENGELÄ°
       - giriÅŸ alanlarÄ±nÄ± etkilemez
       ========== */
    (function kilitleriKur(){
      const rapor = document.getElementById("raporMetni");

      // SaÄŸ tÄ±k kapalÄ± (sadece rapor alanÄ±nda)
      rapor.addEventListener("contextmenu", (e) => e.preventDefault());

      // Copy/Cut kapalÄ± (sadece rapor alanÄ±nda)
      rapor.addEventListener("copy", (e) => e.preventDefault());
      rapor.addEventListener("cut", (e) => e.preventDefault());

      // SeÃ§im baÅŸlatma engeli (mouse)
      rapor.addEventListener("selectstart", (e) => e.preventDefault());

      // Ctrl+C, Ctrl+X, Ctrl+A engeli (sadece rapor alanÄ± odaktaysa)
      document.addEventListener("keydown", (e) => {
        const key = (e.key || "").toLowerCase();
        const isCtrl = e.ctrlKey || e.metaKey;

        if (!isCtrl) return;

        // aktif element rapor iÃ§indeyse engelle
        // (rapor normalde focus almaz ama yine de garanti)
        const active = document.activeElement;
        const insideRapor = rapor.contains(active);

        // ekstra gÃ¼venlik: eÄŸer kullanÄ±cÄ± bir ÅŸekilde raporu seÃ§meye Ã§alÄ±ÅŸÄ±yorsa engelle
        const sel = window.getSelection ? window.getSelection().toString() : "";
        const anySelectionOnPage = sel && sel.length > 0;

        if ((key === "c" || key === "x" || key === "a") && (insideRapor || anySelectionOnPage)) {
          // NOT: anySelectionOnPage giriÅŸte seÃ§iliyse de engeller, o yÃ¼zden dikkat:
          // Biz sadece rapor alanÄ±nda seÃ§im olmasÄ±nÄ± beklediÄŸimiz iÃ§in ek kontrol:
          // giriÅŸ alanÄ±nda selection olmasÄ±nÄ± engellememek iÃ§in input/textarea odakta ise izin ver.
          const tag = (active && active.tagName) ? active.tagName.toLowerCase() : "";
          const isInputLike = (tag === "input" || tag === "textarea");
          if (!isInputLike) e.preventDefault();
        }
      });
    })();

    /* ==========
       4) TOAST (minik bildirim)
       ========== */
    function toast(msg){
      let t = document.getElementById("toastBox");
      if(!t){
        t = document.createElement("div");
        t.id = "toastBox";
        t.style.position = "fixed";
        t.style.left = "50%";
        t.style.bottom = "86px";
        t.style.transform = "translateX(-50%)";
        t.style.background = "rgba(0,0,0,0.82)";
        t.style.color = "#fff";
        t.style.padding = "10px 14px";
        t.style.borderRadius = "12px";
        t.style.fontSize = "13px";
        t.style.fontWeight = "700";
        t.style.zIndex = "9999";
        t.style.boxShadow = "0 8px 18px rgba(0,0,0,0.22)";
        document.body.appendChild(t);
      }
      t.innerText = msg;
      t.style.opacity = "1";
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => { t.style.opacity = "0"; }, 1600);
    }

    // sayfa aÃ§Ä±lÄ±nca taslak varsa otomatik yÃ¼kle (istersen kapat)
    taslakYukle();
  </script>

  <!-- ==========
    FIREBASE KULLANACAKSAN (OPSÄ°YONEL)
    - Projende firebase-config.js zaten varsa bunu aÃ§abilirsin.
    - Firebase yoksa bu kÄ±smÄ± hiÃ§ ekleme / kapalÄ± tut.
  ==========

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    // Ã–RNEK: Firestore'a kaydet/yÃ¼kle (kendi koleksiyon/alanlarÄ±na gÃ¶re dÃ¼zenlersin)
    async function firebaseKaydet(uid){
      const data = {
        inpTarih: document.getElementById("inpTarih").value,
        inpKapsam: document.getElementById("inpKapsam").value,
        inpAciklama: document.getElementById("inpAciklama").value,
        inpListe: document.getElementById("inpListe").value,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      await db.collection("raporlar").doc(uid).collection("moduller").doc("belgeler").set(data, { merge:true });
      toast("Firebase'e kaydedildi âœ…");
    }

    async function firebaseYukle(uid){
      const doc = await db.collection("raporlar").doc(uid).collection("moduller").doc("belgeler").get();
      if(!doc.exists){ toast("Firebase taslak yok âš ï¸"); return; }
      const data = doc.data() || {};
      document.getElementById("inpTarih").value = data.inpTarih || "";
      document.getElementById("inpKapsam").value = data.inpKapsam || "Genel";
      document.getElementById("inpAciklama").value = data.inpAciklama || "";
      document.getElementById("inpListe").value = data.inpListe || "";
      toast("Firebase taslak yÃ¼klendi âœ…");
      raporOlustur();
    }
  </script>
  -->

</body>
</html>
